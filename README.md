# Microservice Example

## What are Microservice ?

## Why use Microservice ?

### Content

### Contents

* **[1 Introduction to Microservice](#1-introduction-to-microservice)**
  * [1.1 What are Microservice ?](#11-what-are-microservice?)
  * [1.2 Why use Microservice ?](#12-why-use-microservice?)
  * [1.3 Features of Microservice](#13-features-of-microservice)
* **[2 Getting Microservice Example](#2-getting-microservice-example)**
  * [2.1 Building Microservice Example](#21-building-microservice-example)
  * [2.2 Maven Central Releases](#22-maven-central-releases)
  * [2.3 Latest SNAPSHOT Release](#23-latest-snapshot-releases)
  * [2.4 Adding Microservice API to Your Maven Project](#13-adding-microservice-api-to-your-maven-project)

## 1 Introduction to Microservice

### 1.1 What are Microservice ?

### 1.2 Why use Microservice ?

### 1.3 Features of Microservice

## 2 Getting Rules Engine

### 2.1 Building Microservice Example
```bash
git clone git@github.com:hydrator/example-microservice.git
cd example-microservice
mvn clean package
```

### 2.2 Maven Central Releases

### 2.3 Latest SNAPSHOT Release

### 2.4 Adding Rules Engine to your Maven Project
_Add the code below to your pom.xml_

```xml
<dependency>
    <groupId>co.cask.microservice</groupId>
    <artifactId>microservice-api</artifactId>
    <version>1.0.0</version>
</dependency>
```



There are three microservices in this project to demonstrate the capabilities of microservices and how to build them on top of CDA

*ProducerMicroservice* - generates consecutive numbers from 1 periodically at configured delay.
*ProcessorMicroservice* - receives a number and checks if it is a multiple of a configured number. Emits that number if and only if it is a multiple.
*ConsumerMicroservice* - receives a number and logs it

The above microservices can be connected in this order:

*ProducerMicroservice --> ProcessorMicroservice --> ConsumerMicroservice*

Note that the '-->' connections/channels are configurable and it is defined by the user in the config.json. Currently supported channel types are TMS and Amazon SQS.

If you are using TMS, the following properties are expected to be provied:
	* topic
	* namespace

If you are using Amazon SQS, the following properties are expected to be provided:
	* queue-name
	* access-id
	* access-key
	* region-name

Usage:
------

Prerequisites:
--------------

1. Download latest CDAP from cask.co/get-cdap


In order to deploy and use the Example microservices, follow these steps.

1. Download microservice-app-1.0 jar from the maven central (http://search.maven.org/remotecontent?filepath=co/cask/microservice-app/1.0/microservice-app-1.0.jar)
2. Load that artifact using the CDAP CLI : load artifact ~/microservice-app-1.0.jar
3. Build this project using maven : mvn clean package
4. Load the artifact generated by the previous step using the CDAP CLI : load artifact ~/example-microservice/target/ExampleMicroservices-1.0-SNAPSHOT.jar config-file ~/example-microservice/target/ExampleMicroservices-1.0-SNAPSHOT.json
5. Create three apps using the CDAP CLI as follows:
	* create app ProducerApp microservice-app 1.0 USER ~/example-microservice/src/main/resources/producer-microservice-config.json
	* create app ProcessorApp microservice-app 1.0 USER ~/example-microservice/src/main/resources/processor-microservice-config.json
	* create app ConsumerApp microservice-app 1.0 USER ~/example-microservice/src/main/resources/consumer-microservice-config.json
6. Start the Workers in the apps created in the previous step using CDAP CLI:
	* start worker ProducerApp.microservice
	* start worker ProcessorApp.microservice
	* start worker ConsumerApp.microservice
7. Check the logs of the workers ensure that the microservices are working.
8. To stop the microservices, simply stop the workers using CDAP CLI:
	* stop worker ProducerApp.microservice
	* stop worker ProcessorApp.microservice
	* stop worker ConsumerApp.microservice
